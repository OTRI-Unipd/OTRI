<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>otri.database.database_adapter API documentation</title>
<meta name="description" content="Basic SQLAlchemy wrapper providing some common functionalities for interfacing with a database." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>otri.database.database_adapter</code></h1>
</header>
<section id="section-intro">
<p>Basic SQLAlchemy wrapper providing some common functionalities for interfacing with a database.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Basic SQLAlchemy wrapper providing some common functionalities for interfacing with a database.
&#34;&#34;&#34;

from .database_query import DatabaseQuery
from .database_data import DatabaseData

import warnings

from typing import Iterable, List, Mapping, Union
from contextlib import contextmanager
from pathlib import Path
from sqlalchemy import *
from sqlalchemy.orm import sessionmaker
from sqlalchemy.ext.automap import automap_base
from sqlalchemy.dialects.postgresql import JSONB

from ..utils import config
from ..utils import logger as log

HOST_KEY = &#34;postgresql_host&#34;
PORT_KEY = &#34;postgresql_port&#34;
USER_KEY = &#34;postgresql_user&#34;
PASSWORD_KEY = &#34;postgresql_password&#34;
DATABASE_KEY = &#34;postgresql_database&#34;


class DatabaseAdapter:
    &#39;&#39;&#39;
    Abstract class used to access with the same methods independently from the kind of database used.
    Uses SQLAlchemy to interface with the database.
    &#39;&#39;&#39;

    def __init__(self, host: str, port: Union[str, int], user: str, password: str, database: str):
        &#39;&#39;&#39;
        Parameters:
            host : str\n
                The database host address.\n
            port : Union[str, int]\n
                The port on which the database is listening.\n
            user : str\n
                The username.\n
            password : str\n
                The password for the given user.\n
            database : str\n
                The database on which to connect.
        &#39;&#39;&#39;
        try:
            log.i(&#34;Trying to connect to database.&#34;)
            conn_str = self._connection_string().format(
                user,
                password,
                host,
                port,
                database
            )
            self._engine = create_engine(conn_str)
            self._Base = automap_base()
            self._Base.prepare(self._engine, reflect=True)
            self._Session = sessionmaker(bind=self._engine)
            log.i(&#34;Connected to the database.&#34;)
        
        except (Exception) as error:
            log.e(&#34;Error while connecting to the database&#34;)
            raise


    def get_tables(self) -&gt; Mapping:
        &#39;&#39;&#39;
        Retrieve the SQLAlchemy reflected tables for the db.

        Returns:
            A dictionary containing the tables for the database. The tables can be retrieved both as
            string keys and attributes. So, for a table named &#34;users&#34;:
            ```python
            adapter.get_tables()[&#34;users&#34;]
            adapter.get_tables().users
            ```
            Are both valid.
        &#39;&#39;&#39;
        return self._Base.classes

    def add(self, value):
        &#39;&#39;&#39;
        Add a single value to the database and commit the change.

        Parameters:
            value\n
                Must be an object from one of the already existing tables retrieved via
                `DatabaseAdapter.get_tables()`.
        &#39;&#39;&#39;
        session = self._Session()
        try:
            session.add(value)
            session.commit()
            log.v(&#34;Uploaded an item to {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during upload to {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def add_all(self, values: List):
        &#39;&#39;&#39;
        Same as `DatabaseAdapter.add(value)` for multiple values. The change is immediately
        committed.

        Parameters:
            values : List\n
                List of values to add to the db, they must be objects from existing tables.
        &#39;&#39;&#39;
        session = self._Session()
        log.i(&#34;Opened session on {}&#34;.format(self))
        try:
            session.add_all(values)
            log.i(&#34;Added items to {} session.&#34;.format(self))
            session.commit()
            log.i(&#34;Uploaded items to {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during upload to {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def delete(self, value):
        &#39;&#39;&#39;
        Delete a value from the database and immediately commit.

        Parameters:
            value\n
                Must be an object from one of the already existing tables retrieved via
                `DatabaseAdapter.get_tables()`.
        &#39;&#39;&#39;
        session = self._Session()
        try:
            session.delete(value)
            session.commit()
            log.v(&#34;Removed items from {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during removal from {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def delete_all(self, values: List):
        &#39;&#39;&#39;
        Delete some values from the database and commit if all got deleted.

        Parameters:
            values : List\n
                List of values to remove from the db, they must be objects from existing tables.
        &#39;&#39;&#39;
        session = self._Session()
        try:
            for v in values:
                session.delete(v)
            session.commit()
            log.v(&#34;Removed items from {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during removal from {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def query(self, *items):
        &#39;&#39;&#39;
        Return a read-only query.
        &#39;&#39;&#39;

    @contextmanager
    def session(self):
        &#34;&#34;&#34;
        Context Manager (can use in `with` blocks), opens a session to operate on the database.
        Once the session is open, you can still perform operations on the database directly, but
        they will not be included in the transaction of this session.

        If using this in a `with` block, if no error arises the session commits when exiting the
        block, otherwise it calls `rollback()`.

        Use this if you need any querying or advanced operations.
        &#34;&#34;&#34;
        session = self._Session()
        try:
            yield session
            # Commit when with block exits.
            session.commit()
        except:
            # Rollback if exception.
            session.rollback()
            log.e(&#34;Error during session on {}. Rolling back...&#34;.format(self))
            raise
        finally:
            # Close either way.
            session.close()

    def _connection_string(self) -&gt; str:
        &#39;&#39;&#39;
        Retrieve an appropriate connection String. Implement this method in subclasses.

        Returns:
            A connection string, based on the database type and engine to use, ready to be formatted
            with the user info.
        &#39;&#39;&#39;
        raise NotImplementedError(&#34;This is an abstract method, please implement it in a sub-class&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="otri.database.database_adapter.DatabaseAdapter"><code class="flex name class">
<span>class <span class="ident">DatabaseAdapter</span></span>
<span>(</span><span>host: str, port: Union[str, int], user: str, password: str, database: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Abstract class used to access with the same methods independently from the kind of database used.
Uses SQLAlchemy to interface with the database.</p>
<h2 id="parameters">Parameters</h2>
<p>host : str</p>
<pre><code>The database host address.
</code></pre>
<p>port : Union[str, int]</p>
<pre><code>The port on which the database is listening.
</code></pre>
<p>user : str</p>
<pre><code>The username.
</code></pre>
<p>password : str</p>
<pre><code>The password for the given user.
</code></pre>
<p>database : str</p>
<pre><code>The database on which to connect.
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class DatabaseAdapter:
    &#39;&#39;&#39;
    Abstract class used to access with the same methods independently from the kind of database used.
    Uses SQLAlchemy to interface with the database.
    &#39;&#39;&#39;

    def __init__(self, host: str, port: Union[str, int], user: str, password: str, database: str):
        &#39;&#39;&#39;
        Parameters:
            host : str\n
                The database host address.\n
            port : Union[str, int]\n
                The port on which the database is listening.\n
            user : str\n
                The username.\n
            password : str\n
                The password for the given user.\n
            database : str\n
                The database on which to connect.
        &#39;&#39;&#39;
        try:
            log.i(&#34;Trying to connect to database.&#34;)
            conn_str = self._connection_string().format(
                user,
                password,
                host,
                port,
                database
            )
            self._engine = create_engine(conn_str)
            self._Base = automap_base()
            self._Base.prepare(self._engine, reflect=True)
            self._Session = sessionmaker(bind=self._engine)
            log.i(&#34;Connected to the database.&#34;)
        
        except (Exception) as error:
            log.e(&#34;Error while connecting to the database&#34;)
            raise


    def get_tables(self) -&gt; Mapping:
        &#39;&#39;&#39;
        Retrieve the SQLAlchemy reflected tables for the db.

        Returns:
            A dictionary containing the tables for the database. The tables can be retrieved both as
            string keys and attributes. So, for a table named &#34;users&#34;:
            ```python
            adapter.get_tables()[&#34;users&#34;]
            adapter.get_tables().users
            ```
            Are both valid.
        &#39;&#39;&#39;
        return self._Base.classes

    def add(self, value):
        &#39;&#39;&#39;
        Add a single value to the database and commit the change.

        Parameters:
            value\n
                Must be an object from one of the already existing tables retrieved via
                `DatabaseAdapter.get_tables()`.
        &#39;&#39;&#39;
        session = self._Session()
        try:
            session.add(value)
            session.commit()
            log.v(&#34;Uploaded an item to {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during upload to {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def add_all(self, values: List):
        &#39;&#39;&#39;
        Same as `DatabaseAdapter.add(value)` for multiple values. The change is immediately
        committed.

        Parameters:
            values : List\n
                List of values to add to the db, they must be objects from existing tables.
        &#39;&#39;&#39;
        session = self._Session()
        log.i(&#34;Opened session on {}&#34;.format(self))
        try:
            session.add_all(values)
            log.i(&#34;Added items to {} session.&#34;.format(self))
            session.commit()
            log.i(&#34;Uploaded items to {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during upload to {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def delete(self, value):
        &#39;&#39;&#39;
        Delete a value from the database and immediately commit.

        Parameters:
            value\n
                Must be an object from one of the already existing tables retrieved via
                `DatabaseAdapter.get_tables()`.
        &#39;&#39;&#39;
        session = self._Session()
        try:
            session.delete(value)
            session.commit()
            log.v(&#34;Removed items from {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during removal from {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def delete_all(self, values: List):
        &#39;&#39;&#39;
        Delete some values from the database and commit if all got deleted.

        Parameters:
            values : List\n
                List of values to remove from the db, they must be objects from existing tables.
        &#39;&#39;&#39;
        session = self._Session()
        try:
            for v in values:
                session.delete(v)
            session.commit()
            log.v(&#34;Removed items from {} database.&#34;.format(self))
        except:
            session.rollback()
            log.e(&#34;Error during removal from {}. Rolling back...&#34;.format(self))
            raise
        finally:
            session.close()

    def query(self, *items):
        &#39;&#39;&#39;
        Return a read-only query.
        &#39;&#39;&#39;

    @contextmanager
    def session(self):
        &#34;&#34;&#34;
        Context Manager (can use in `with` blocks), opens a session to operate on the database.
        Once the session is open, you can still perform operations on the database directly, but
        they will not be included in the transaction of this session.

        If using this in a `with` block, if no error arises the session commits when exiting the
        block, otherwise it calls `rollback()`.

        Use this if you need any querying or advanced operations.
        &#34;&#34;&#34;
        session = self._Session()
        try:
            yield session
            # Commit when with block exits.
            session.commit()
        except:
            # Rollback if exception.
            session.rollback()
            log.e(&#34;Error during session on {}. Rolling back...&#34;.format(self))
            raise
        finally:
            # Close either way.
            session.close()

    def _connection_string(self) -&gt; str:
        &#39;&#39;&#39;
        Retrieve an appropriate connection String. Implement this method in subclasses.

        Returns:
            A connection string, based on the database type and engine to use, ready to be formatted
            with the user info.
        &#39;&#39;&#39;
        raise NotImplementedError(&#34;This is an abstract method, please implement it in a sub-class&#34;)</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="otri.database.postgresql_adapter.PostgreSQLAdapter" href="postgresql_adapter.html#otri.database.postgresql_adapter.PostgreSQLAdapter">PostgreSQLAdapter</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="otri.database.database_adapter.DatabaseAdapter.add"><code class="name flex">
<span>def <span class="ident">add</span></span>(<span>self, value)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a single value to the database and commit the change.</p>
<h2 id="parameters">Parameters</h2>
<p>value</p>
<pre><code>Must be an object from one of the already existing tables retrieved via
&lt;code&gt;&lt;a title="otri.database.database_adapter.DatabaseAdapter.get_tables" href="#otri.database.database_adapter.DatabaseAdapter.get_tables"&gt;DatabaseAdapter.get\_tables()&lt;/a&gt;&lt;/code&gt;.
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add(self, value):
    &#39;&#39;&#39;
    Add a single value to the database and commit the change.

    Parameters:
        value\n
            Must be an object from one of the already existing tables retrieved via
            `DatabaseAdapter.get_tables()`.
    &#39;&#39;&#39;
    session = self._Session()
    try:
        session.add(value)
        session.commit()
        log.v(&#34;Uploaded an item to {} database.&#34;.format(self))
    except:
        session.rollback()
        log.e(&#34;Error during upload to {}. Rolling back...&#34;.format(self))
        raise
    finally:
        session.close()</code></pre>
</details>
</dd>
<dt id="otri.database.database_adapter.DatabaseAdapter.add_all"><code class="name flex">
<span>def <span class="ident">add_all</span></span>(<span>self, values: List)</span>
</code></dt>
<dd>
<div class="desc"><p>Same as <code><a title="otri.database.database_adapter.DatabaseAdapter.add" href="#otri.database.database_adapter.DatabaseAdapter.add">DatabaseAdapter.add()</a>(value)</code> for multiple values. The change is immediately
committed.</p>
<h2 id="parameters">Parameters</h2>
<p>values : List</p>
<pre><code>List of values to add to the db, they must be objects from existing tables.
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_all(self, values: List):
    &#39;&#39;&#39;
    Same as `DatabaseAdapter.add(value)` for multiple values. The change is immediately
    committed.

    Parameters:
        values : List\n
            List of values to add to the db, they must be objects from existing tables.
    &#39;&#39;&#39;
    session = self._Session()
    log.i(&#34;Opened session on {}&#34;.format(self))
    try:
        session.add_all(values)
        log.i(&#34;Added items to {} session.&#34;.format(self))
        session.commit()
        log.i(&#34;Uploaded items to {} database.&#34;.format(self))
    except:
        session.rollback()
        log.e(&#34;Error during upload to {}. Rolling back...&#34;.format(self))
        raise
    finally:
        session.close()</code></pre>
</details>
</dd>
<dt id="otri.database.database_adapter.DatabaseAdapter.delete"><code class="name flex">
<span>def <span class="ident">delete</span></span>(<span>self, value)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete a value from the database and immediately commit.</p>
<h2 id="parameters">Parameters</h2>
<p>value</p>
<pre><code>Must be an object from one of the already existing tables retrieved via
&lt;code&gt;&lt;a title="otri.database.database_adapter.DatabaseAdapter.get_tables" href="#otri.database.database_adapter.DatabaseAdapter.get_tables"&gt;DatabaseAdapter.get\_tables()&lt;/a&gt;&lt;/code&gt;.
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete(self, value):
    &#39;&#39;&#39;
    Delete a value from the database and immediately commit.

    Parameters:
        value\n
            Must be an object from one of the already existing tables retrieved via
            `DatabaseAdapter.get_tables()`.
    &#39;&#39;&#39;
    session = self._Session()
    try:
        session.delete(value)
        session.commit()
        log.v(&#34;Removed items from {} database.&#34;.format(self))
    except:
        session.rollback()
        log.e(&#34;Error during removal from {}. Rolling back...&#34;.format(self))
        raise
    finally:
        session.close()</code></pre>
</details>
</dd>
<dt id="otri.database.database_adapter.DatabaseAdapter.delete_all"><code class="name flex">
<span>def <span class="ident">delete_all</span></span>(<span>self, values: List)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete some values from the database and commit if all got deleted.</p>
<h2 id="parameters">Parameters</h2>
<p>values : List</p>
<pre><code>List of values to remove from the db, they must be objects from existing tables.
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_all(self, values: List):
    &#39;&#39;&#39;
    Delete some values from the database and commit if all got deleted.

    Parameters:
        values : List\n
            List of values to remove from the db, they must be objects from existing tables.
    &#39;&#39;&#39;
    session = self._Session()
    try:
        for v in values:
            session.delete(v)
        session.commit()
        log.v(&#34;Removed items from {} database.&#34;.format(self))
    except:
        session.rollback()
        log.e(&#34;Error during removal from {}. Rolling back...&#34;.format(self))
        raise
    finally:
        session.close()</code></pre>
</details>
</dd>
<dt id="otri.database.database_adapter.DatabaseAdapter.get_tables"><code class="name flex">
<span>def <span class="ident">get_tables</span></span>(<span>self) ‑> Mapping</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the SQLAlchemy reflected tables for the db.</p>
<h2 id="returns">Returns</h2>
<p>A dictionary containing the tables for the database. The tables can be retrieved both as
string keys and attributes. So, for a table named "users":</p>
<pre><code class="python">adapter.get_tables()[&quot;users&quot;]
adapter.get_tables().users
</code></pre>
<p>Are both valid.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_tables(self) -&gt; Mapping:
    &#39;&#39;&#39;
    Retrieve the SQLAlchemy reflected tables for the db.

    Returns:
        A dictionary containing the tables for the database. The tables can be retrieved both as
        string keys and attributes. So, for a table named &#34;users&#34;:
        ```python
        adapter.get_tables()[&#34;users&#34;]
        adapter.get_tables().users
        ```
        Are both valid.
    &#39;&#39;&#39;
    return self._Base.classes</code></pre>
</details>
</dd>
<dt id="otri.database.database_adapter.DatabaseAdapter.query"><code class="name flex">
<span>def <span class="ident">query</span></span>(<span>self, *items)</span>
</code></dt>
<dd>
<div class="desc"><p>Return a read-only query.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def query(self, *items):
    &#39;&#39;&#39;
    Return a read-only query.
    &#39;&#39;&#39;</code></pre>
</details>
</dd>
<dt id="otri.database.database_adapter.DatabaseAdapter.session"><code class="name flex">
<span>def <span class="ident">session</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Context Manager (can use in <code>with</code> blocks), opens a session to operate on the database.
Once the session is open, you can still perform operations on the database directly, but
they will not be included in the transaction of this session.</p>
<p>If using this in a <code>with</code> block, if no error arises the session commits when exiting the
block, otherwise it calls <code>rollback()</code>.</p>
<p>Use this if you need any querying or advanced operations.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@contextmanager
def session(self):
    &#34;&#34;&#34;
    Context Manager (can use in `with` blocks), opens a session to operate on the database.
    Once the session is open, you can still perform operations on the database directly, but
    they will not be included in the transaction of this session.

    If using this in a `with` block, if no error arises the session commits when exiting the
    block, otherwise it calls `rollback()`.

    Use this if you need any querying or advanced operations.
    &#34;&#34;&#34;
    session = self._Session()
    try:
        yield session
        # Commit when with block exits.
        session.commit()
    except:
        # Rollback if exception.
        session.rollback()
        log.e(&#34;Error during session on {}. Rolling back...&#34;.format(self))
        raise
    finally:
        # Close either way.
        session.close()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="otri.database" href="index.html">otri.database</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="otri.database.database_adapter.DatabaseAdapter" href="#otri.database.database_adapter.DatabaseAdapter">DatabaseAdapter</a></code></h4>
<ul class="two-column">
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.add" href="#otri.database.database_adapter.DatabaseAdapter.add">add</a></code></li>
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.add_all" href="#otri.database.database_adapter.DatabaseAdapter.add_all">add_all</a></code></li>
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.delete" href="#otri.database.database_adapter.DatabaseAdapter.delete">delete</a></code></li>
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.delete_all" href="#otri.database.database_adapter.DatabaseAdapter.delete_all">delete_all</a></code></li>
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.get_tables" href="#otri.database.database_adapter.DatabaseAdapter.get_tables">get_tables</a></code></li>
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.query" href="#otri.database.database_adapter.DatabaseAdapter.query">query</a></code></li>
<li><code><a title="otri.database.database_adapter.DatabaseAdapter.session" href="#otri.database.database_adapter.DatabaseAdapter.session">session</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>